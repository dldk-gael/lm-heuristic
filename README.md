# lm-heuristic

## Project description

The purpose of this package is to find the most *natural* sentence among all sentences 
that can be been generated by a given formal grammar

## Setup

```
git clone https://github.com/dldk-gael/lm-heuristic.git
cd lm-heuristic
pip install .
```


## Package architecture 

- **sentence_score** provide an interface towards transformers-based model (GPT2 and BERT) that are used to associate a sentence with a *naturalness* score. 

- **tree** define 
    - an abstract class **tree.Node** from which all tree structure must inheritate
    - **tree.TreeStats** which can be used to accumulate statistics on a given tree. 

- **tree.interface** is used to generate grammar tree. 
    - when using **ntlk_grammar.CFGrammarNode** or **nltk_grammar.FeatureGrammarNode**, grammars are processes using nltk grammar parsers and grammar trees are generated based on nltk internal representation of such grammar 
    - when using **prolog.PrologGrammarNode**, the grammars are first transformed into prolog predicates and then a **PrologEngine** based on [Pyswip](https://pypi.org/project/pyswip/) is used to compute the nodes and leave of the tree grammar. In order to use this module, it is needed to first [install SWI-Prolog](https://www.swi-prolog.org/download/stable).

- **tree_search** define:
    - an **tree_search.Evaluator** use to wrap an evaluation function (that takes as input a list of **Node** and return the associated list of scores). Moreover it adds on top of the evaluation function a memory buffer and keep also statistics about the call to the evaluation function. 
    -  an abstract **TreeSearch** from which all tree search strategies must inheritate. A **TreeSearch** object is initialized with an **Evaluator** object. Then given, a root (**tree.Node**) and a number of tree walks that are allowed, it try to search a leave that maximize the **Evaluator** object. 

- **tree_search.mcts** uses Monte Carlo algorithm to perfom the tree search. The algorithm is divide in several submodules :
    - **MonteCarloTreeSearch** which implements the different steps that are at the core of the algorithm (selection, expansion, simulation, evaluation, backpropagation)
    - **CounterNode** that is used by the MCTS to maintain stastistics over the tree nodes. 
    - **EvalBuffer** that allows to evaluate the tree's leave by batch rather that one by one. **ParallelEvalBuffer** makes it possible to run this evaluation is another process / thread. 
    - **RessourceDistributor** that let the user the possibility to specify how the computationnal ressource (ie: the tree walks who be divided)
 
- **tree_search.random.RandomSearch** implements a naive search that randomly sample the tree to find the best leaf.

- **benchmark** define an experimentation framework. It take as input : a list of tree search strategy, 
a tree dataset, perform different type of evaluation on it and store the results all of the experiments in a panda dataframe.

- **generation** specifies some modules to quickly generate text from grammar or transformers. 

## Examples

Various examples on how to use all those module can be found in [*examples*](https://github.com/dldk-gael/lm-heuristic/tree/master/examples).

## Server

Contain the scripts to launch flask backend server and celery works that can provide paraphrase generation and grammar sampling. A example of a front-end using this API can be found [here](https://github.com/dldk-gael/grammar_generator). More information on server operation can be found on [server/readme](https://github.com/dldk-gael/lm-heuristic/tree/master/server).
